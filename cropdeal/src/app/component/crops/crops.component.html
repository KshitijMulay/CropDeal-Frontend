<div class="container my-5">
  <h2 class="text-center mb-4 text-success fw-bold">Available Crops</h2>
  
  <!-- Search, Filter, and Sort Controls (only on full page) -->
  <div class="row mb-4" *ngIf="isFullPage">
    <div class="col-md-4 mb-3">
      <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input 
          type="text" 
          class="form-control" 
          placeholder="Search crops..." 
          [(ngModel)]="searchTerm" 
          (input)="onSearch()">
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <select class="form-select" [(ngModel)]="selectedCropType" (change)="onFilterChange()">
        <option value="">All Types</option>
        <option *ngFor="let type of cropTypes.slice(1)" [value]="type">{{ type }}</option>
      </select>
    </div>
    <div class="col-md-3 mb-3">
      <select class="form-select" [(ngModel)]="sortBy" (change)="onSortChange()">
        <option value="cropName">Sort by Name</option>
        <option value="pricePerKg">Sort by Price</option>
        <option value="quantityAvailable">Sort by Quantity</option>
        <option value="postedAt">Sort by Date</option>
      </select>
    </div>
    <div class="col-md-2 mb-3">
      <div class="btn-group w-100" role="group">
        <button 
          class="btn btn-outline-secondary" 
          [class.active]="sortOrder === 'asc'"
          (click)="sortOrder = 'asc'; onSortChange()">
          <i class="bi bi-sort-up"></i>
        </button>
        <button 
          class="btn btn-outline-secondary" 
          [class.active]="sortOrder === 'desc'"
          (click)="sortOrder = 'desc'; onSortChange()">
          <i class="bi bi-sort-down"></i>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Results Count and Clear Filters (only on full page) -->
  <div class="d-flex justify-content-between align-items-center mb-3" *ngIf="isFullPage">
    <span class="text-muted">{{ filteredCrops.length }} crops found</span>
    <button class="btn btn-outline-secondary btn-sm" (click)="clearFilters()">
      <i class="bi bi-x-circle me-1"></i>Clear Filters
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center my-5">
    <div class="spinner-border text-success" role="status"></div>
    <p class="mt-2">Loading crops...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger text-center">
    {{ error }}
  </div>

  <!-- No Crops -->
  <div
    *ngIf="!loading && displayedCrops.length === 0 && !error"
    class="text-center text-muted py-5"
  >
    <i class="bi bi-search text-muted" style="font-size: 3rem;"></i>
    <h5 class="mt-3">No crops found</h5>
    <p>Try adjusting your search or filter criteria.</p>
  </div>

  <!-- Crop Cards -->
  <div *ngIf="!loading && displayedCrops.length > 0" class="row g-4 crop-grid">
    <div class="col-sm-6 col-md-4 col-lg-3 crop-item" *ngFor="let crop of displayedCrops; let i = index" [style.animation-delay.ms]="i * 100">
      <div class="card h-100 shadow-sm border-0 crop-card">
        <div class="image-container">
          <img
            src="https://plus.unsplash.com/premium_photo-1671379041175-782d15092945?q=80&w=1920&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            class="card-img-top"
            [alt]="crop.cropName"
          />
          <!-- <img
            [src]="'https://source.unsplash.com/600x400/?' + crop.cropName"
            class="card-img-top"
            [alt]="crop.cropName"
          /> -->
          <!-- <img
            ngSrc="https://images.unsplash.com/photo-1719760665635-e35b687b2028?q=80&w=2070&au…p&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            alt="An image"
            width="500"
            height="300"
          /> -->
        </div>

        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-success">{{ crop.cropName }}</h5>
          <p class="card-text mb-1">
            <strong>Type:</strong> {{ crop.cropType }}
          </p>
          <p class="card-text mb-1">
            <strong>Available:</strong> {{ crop.quantityAvailable }} kg
          </p>
          <p class="card-text mb-1">
            <strong>Price:</strong> ₹{{ crop.pricePerKg }}/kg
          </p>

          <span
            class="badge mt-2 px-3 py-2 fs-6"
            [ngClass]="{
              'bg-success': crop.status === 'Available',
              'bg-secondary': crop.status !== 'Available'
            }"
          >
            {{ crop.status }}
          </span>

          <p class="mt-2 text-muted small mb-3">
            Posted on {{ crop.postedAt | date : "mediumDate" }}
          </p>

          <!-- Booking Section -->
          <div *ngIf="crop.status === 'Available'" class="mt-auto">
            <input
              *ngIf="isLoggedIn"
              type="number"
              [(ngModel)]="crop.selectedQuantity"
              [max]="crop.quantityAvailable"
              min="1"
              class="form-control mb-2"
              placeholder="Enter quantity (kg)"
            />
            <button 
              class="btn w-100" 
              [ngClass]="isLoggedIn ? 'btn-success' : 'btn-warning'"
              (click)="isLoggedIn ? bookAndPay(crop) : redirectToLogin()">
              {{ isLoggedIn ? 'Book' : 'Login to Book Crops' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
